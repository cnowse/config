# ‰ΩúËÄÖÔºöwalls1717
# 2023-03-21 10:54
#=========================
parsers: # array
  - reg: ^.*$
    code: |
      module.exports.parse = (raw, { yaml }) => {
        const rawObj = yaml.parse(raw)
        const groups = []
        const rules = []
        return yaml.stringify({ ...rawObj, 'proxy-groups': groups, rules })
      }
    yaml:
      prepend-proxy-groups: # Âª∫Á´ãÁ≠ñÁï•ÁªÑ
        - name: Select
          type: select

        - name: Outside
          type: select
          proxies:
            - SG
            - HK
            - Select

        - name: Final
          type: select
          proxies:
            - Outside
            - Direct

        - name: YouTube
          type: select
          proxies:
            - HK
            - SG
            - Outside

        - name: Spotify
          type: select
          proxies:
            - Outside
            - Direct
            - Select

        - name: Bilibili
          type: select
          proxies:
            - HK
            - Direct
        - name: Microsoft
          type: select
          proxies:
            - Direct
            - Outside

        - name: Direct
          type: select
          proxies:
            - DIRECT

        - name: SG
          type: url-test
          url: http://www.msftconnecttest.com/connecttest.txt
          interval: 3600

        - name: HK
          type: url-test
          url: http://www.msftconnecttest.com/connecttest.txt
          interval: 3600

      commands:
        - proxy-groups.Select.proxies=[]proxyNames|^.*$
        - proxy-groups.SG.proxies=[]proxyNames|(?=.*(üá∏üá¨|Êñ∞Âä†Âù°|SG|sg|SGP|sgp|Singapore|ÁãÆÂüé))
        - proxy-groups.HK.proxies=[]proxyNames|(?=.*(üá≠üá∞|È¶ôÊ∏Ø|HK|HKG|hk|hkg|Hong Kong|HongKong|hongkong|hong kong))^(?!.*(ÁßªÂä®))

      prepend-rules: # ËßÑÂàôÁî±‰∏äÂæÄ‰∏ãÈÅçÂéÜÔºåÂ¶Ç‰∏äÈù¢ËßÑÂàôÂ∑≤ÁªèÂëΩ‰∏≠ÔºåÂàô‰∏çÂÜçÂæÄ‰∏ãÂ§ÑÁêÜ
        - DOMAIN,clash.razord.top,DIRECT
        - DOMAIN,yacd.haishan.me,DIRECT
        - RULE-SET,Direct,DIRECT
        - RULE-SET,Advertising_Classical,REJECT
        - RULE-SET,YouTube,YouTube
        - RULE-SET,YouTubeMusic,YouTube
        - RULE-SET,Spotify,Spotify
        - RULE-SET,Microsoft,Microsoft
        - RULE-SET,Bilibili,Bilibili
        - RULE-SET,Global,Outside
        - RULE-SET,China,DIRECT
        - GEOIP,CN,DIRECT
        - MATCH,Final

      mix-rule-providers:
        Direct:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Direct/Direct.yaml"
          path: ./ruleset/Direct.yaml
          interval: 86400

        Advertising_Classical:
          type: http
          behavior: classical
          url: "https://ghproxy.com/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising_Classical.yaml"
          path: ./ruleset/Advertising_Classical.yaml
          interval: 86400

        YouTube:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube.yaml"
          path: ./ruleset/YouTube.yaml
          interval: 86400

        YouTubeMusic:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTubeMusic/YouTubeMusic.yaml"
          path: ./ruleset/YouTubeMusic.yaml
          interval: 86400

        Spotify:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Spotify/Spotify.yaml"
          path: ./ruleset/Spotify.yaml
          interval: 86400

        Microsoft:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Microsoft/Microsoft.yaml"
          path: ./ruleset/Microsoft.yaml
          interval: 86400
        
        Bilibili:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BiliBili/BiliBili.yaml"
          path: ./ruleset/BiliBili.yaml
          interval: 86400

        Global:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Global/Global_Classical.yaml"
          path: ./ruleset/Global_Classical.yaml
          interval: 86400

        China:
          type: http
          behavior: classical
          url: "https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/ChinaMax/ChinaMax_Classical.yaml"
          path: ./ruleset/ChinaMax_Classical.yaml
          interval: 86400